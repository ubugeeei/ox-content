[tools]
rust = "1.92"
node = "22"

[env]
RUST_BACKTRACE = "1"

[tasks.build]
description = "Build all crates"
run = "cargo build --workspace"

[tasks.build-release]
description = "Build all crates in release mode"
run = "cargo build --workspace --release"

[tasks.test]
description = "Run all tests"
run = "cargo test --workspace"

[tasks.test-verbose]
description = "Run all tests with verbose output"
run = "cargo test --workspace -- --nocapture"

[tasks.check]
description = "Check all crates"
run = "cargo check --workspace"

[tasks.clippy]
description = "Run clippy on all crates"
run = "cargo clippy --workspace --all-targets -- -D warnings"

[tasks.fmt]
description = "Format all code"
run = "cargo fmt --all"

[tasks.fmt-check]
description = "Check code formatting"
run = "cargo fmt --all -- --check"

[tasks.lint]
description = "Run all lints (clippy + fmt-check)"
depends = ["clippy", "fmt-check"]

[tasks.bench]
description = "Run benchmarks"
run = "cargo bench --workspace"

[tasks."doc:cargo"]
description = "Generate Rust documentation"
run = "cargo doc --workspace --no-deps"

[tasks."doc:cargo-open"]
description = "Generate and open Rust documentation"
run = "cargo doc --workspace --no-deps --open"

[tasks.clean]
description = "Clean build artifacts"
run = "cargo clean"

[tasks.napi-build]
description = "Build NAPI bindings"
dir = "crates/ox_content_napi"
run = "pnpm build"

[tasks.wasm-build]
description = "Build WASM bindings for browser"
dir = "crates/ox_content_wasm"
run = "wasm-pack build --target web --out-dir pkg"

[tasks.napi-prepublish]
description = "Prepare NAPI package for publishing"
dir = "crates/ox_content_napi"
run = "napi prepublish"

[tasks.ci]
description = "Run CI checks"
depends = ["fmt-check", "clippy", "test"]

[tasks.ready]
description = "Run all checks before committing"
depends = ["fmt", "clippy", "test"]

[tasks.coverage]
description = "Generate test coverage report"
run = "cargo llvm-cov --workspace --html"

[tasks.setup]
description = "Setup development environment"
run = """
rustup component add clippy rustfmt
cargo install cargo-watch cargo-llvm-cov
"""

[tasks.watch]
description = "Watch for changes and run tests"
run = "cargo watch -x test"

[tasks.watch-check]
description = "Watch for changes and run check"
run = "cargo watch -x check"

[tasks.playground]
description = "Start the playground"
dir = "examples/playground"
run = "pnpm run dev"

[tasks.integ-vue]
description = "Start Vue integration example"
dir = "examples/integ-vue"
run = "pnpm run dev"

[tasks.integ-react]
description = "Start React integration example"
dir = "examples/integ-react"
run = "pnpm run dev"

[tasks.integ-svelte]
description = "Start Svelte integration example"
dir = "examples/integ-svelte"
run = "pnpm run dev"

[tasks.ssg-vite]
description = "Start Vite SSG example"
dir = "examples/ssg-vite"
run = "pnpm run dev"

[tasks.plugin-markdown-it]
description = "Run markdown-it plugin example"
dir = "examples/plugin-markdown-it"
run = "pnpm run start"

[tasks.plugin-rehype]
description = "Run rehype plugin example"
dir = "examples/plugin-rehype"
run = "pnpm run start"

[tasks.gen-source-docs]
description = "Run source docs generator example"
dir = "examples/gen-source-docs"
run = "pnpm run dev"

[tasks.packages-build]
description = "Build all vite-plugin packages"
run = "pnpm -r --filter 'vite-plugin-ox-content' --filter 'vite-plugin-ox-content-vue' run build"

[tasks.dev]
description = "Start documentation dev server"
depends = ["napi-build", "packages-build"]
dir = "docs"
run = "pnpm dev"

[tasks.dev-build]
description = "Build documentation site"
depends = ["napi-build", "packages-build"]
dir = "docs"
run = "pnpm build"

[tasks.dev-preview]
description = "Preview documentation build"
dir = "docs"
run = "pnpm preview"

[tasks.install]
description = "Install all dependencies with pnpm"
run = "pnpm install"

[tasks.examples-install]
description = "Install all example dependencies"
depends = ["install"]
